---
import styles from './promo.module.css'
---

<div class={styles.promo}>
	<video
		class={styles.backgroundVideo}
		id="promo-video"
		poster="/images/promo-main-full.webp"
		autoplay
		muted
		loop
		playsinline
	>
	</video>
	<img id="promo-image" src="/images/promo-main-full.webp" alt="Promo" />
	<picture>
		<source media="(min-width: 768px)" srcset="/images/promo-main-full.webp" />
		<source
			media="(max-width: 767px)"
			srcset="/images/promo-main-mobile-full.webp"
		/>
		<img
			class={styles.promoImage}
			id="promo-image"
			src="/images/promo-main-full.webp"
			alt="Фото Даши Кубик"
		/>
	</picture>
	<div class={styles.overlay}>
		<h1 class={styles.mainTitle}>
			Тату мастер из&nbsp;Краснодара <span class={styles.mainTitleSubtitle}
				>Работаю в&nbsp;стиле черно-белый реализм</span
			>
		</h1>
		<a class={styles.button} href="/#portfolio"
			>Посмотреть работы</a
		>
	</div>
</div>

<script>
	function handleVideoDisplay() {
		const video = document.getElementById('promo-video') as HTMLVideoElement
		const image = document.getElementById('promo-image')

		if (window.matchMedia('(min-width: 767px)').matches) {
			if (video) {
				if (!video.querySelector('source')) {
					const source = document.createElement('source')
					source.src = '/promo.mp4'
					source.type = 'video/mp4'
					video.appendChild(source)
				}
				video.load()
				video
					.play()
					.catch((e: Error) => console.log('Video autoplay failed:', e))
			}
		} else {
			if (video) {
				video.pause()
				const source = video.querySelector('source')
				if (source) {
					source.remove()
				}
			}
		}
	}

	document.addEventListener('DOMContentLoaded', handleVideoDisplay)

	window.addEventListener('resize', handleVideoDisplay)
</script>
